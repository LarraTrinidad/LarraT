--
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}

#simulate some data
#set.seed(20160227)
#x<-seq(0,50,1)
#y<-((runif(1,10,20)*x)/(runif(1,0,10)+x))+rnorm(51,0,1)
#for simple models nls find good starting values for the parameters even if it throw a warning

#get some estimation of goodness of fit


library(ggplot2)
library(plyr)
library(dplyr)
library(reshape2)
library(matrixStats)
library(readr)
library(tidyverse)
library(broom)
library(msm)




data <- read.csv("Results_004.csv")
data
data_ <- data.frame(data[-c(1,2,3,4,5),])


t <- data$X
x <- data$Major
y <- data$Minor
#circ <- data$Circ.
#ar <- data$AR

#X <- plot(t,x)
#Y <- plot(t,y)
#plot(t, x/y)
#plot(t,ar)


df <- data.frame(t,x,y) #create data frame from the above vectors
df.m <- melt(df, id.vars="t") # melt the dataframe using topics as id
# plot the lines using ggplot and geom_line
ggplot(data = df.m,
       aes(x = t, y = value, group = variable, color = variable)) + geom_line(size = 1) + ylab("Length [px]") + xlab("Time [s]") +geom_smooth(se = FALSE,
              method = "loess",
              formula = y ~ x)
ggsave("Results_003.png")

# For normalised Major (Major_)
my_sum_plot_ <- df[-c(1,2,3,4),]

ggplot(data = my_sum_plot_,
       aes(x = t, y = x)) + geom_line(size = 1) + ylab("Major Length [px]") + xlab("Time [s]") + geom_point() + geom_smooth(se =FALSE, method = "loess", formula = y ~ x)

# Initial velocity
major_v <- data.frame(df[c(5,6,7,8,9),])
ggplot(data = major_v,
       aes(x = t, y = x)) + geom_line(size = 1) + ylab("Length [px]") + xlab("Time [s]") + geom_point() + geom_smooth(se =TRUE, method = "lm", formula = y ~ x)

model_major_v <- lm(x~t, data = major_v)
predict(model_major_v, data = major_v,interval = "confidence")

summary(model_major_v)

pred.int <- predict(model_major_v, interval = "prediction")
major_v_ <- cbind(major_v, pred.int)



summary(model_major_v)
major_speed <- model_major_v %>% tidy() %>% filter(term == "t") %>% pull(estimate)

p <- ggplot(major_v_, aes(t,x)) + geom_point() + stat_smooth(method = lm, se=FALSE, col="skyblue" )
p
p + geom_line(aes(y=lwr), color = "darkgrey", linetype="dashed")+geom_line(aes(y=upr), color = "darkgrey", linetype="dashed") + ylab("Major Length [px]") + xlab("Time [s]") + annotate("text",x=3,y=0,label = paste0("Recoil velocity = ", major_speed))



# For normalised Minor (Minor_)

my_sum_plot_1 <- df[-c(1,2,3,4),]
ggplot(data = my_sum_plot_1,
       aes(x = t, y = y, group = t)) + geom_line(size = 1) + ylab("Length [px]") + xlab("Time [s]") + geom_point() + geom_smooth(se =TRUE, method = "loess", formula = y ~ x)

time <- my_sum_plot_1$t
Minor <- my_sum_plot_1$y



# Initial velocity
minor_v <- df[c(5,6,7,8,9),]
ggplot(data = minor_v,
       aes(x = t, y = y)) + geom_line(size = 1) + ylab("Length [px]") + xlab("Time [s]") + geom_point() + geom_smooth(se =TRUE, method = "lm", formula = y ~ x)

model_minor_v <- lm(y~t, data = minor_v)
predict(model_minor_v, data = minor_v,interval = "confidence")

summary(model_minor_v)

pred.int <- predict(model_minor_v, interval = "prediction")
minor_v_ <- cbind(minor_v, pred.int)

summary(model_minor_v)
minor_speed <- model_minor_v %>% tidy() %>% filter(term == "t") %>% pull(estimate)

q <- ggplot(minor_v_, aes(t,y)) + geom_point() + stat_smooth(method = lm, se=FALSE, col="skyblue" )
q
q + geom_line(aes(y=lwr), color = "darkgrey", linetype="dashed")+geom_line(aes(y=upr), color = "darkgrey", linetype="dashed") + ylab("Minor Length [px]") + xlab("Time [s]") + annotate("text",x=3,y=0,label = paste0("Recoil velocity = ", minor_speed))



print(major_speed/minor_speed)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

